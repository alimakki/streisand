version 2.0

# make one for each client
# common out the stuff and include them
# conn pluto-1-2
#        also=mytunnel
#        left=1.2.3.4
#        leftid="CN=usercert1"
#        leftrsasigkey=%cert
#        leftcert=/etc/ipsec.d/certs/trash.warrior
#        right=5.6.7.8
#        rightid="CN=usercert2"
#        rightrsasigkey=%cert
#        auto=add

conn ikev2
    left={{ ansible_default_ipv4.address }}
    leftcert=/etc/ipsec.d/certs
    leftid={{ ansible_default_ipv4.address }}
    leftsendcert=always
    leftsubnet={{ ansible_default_ipv4.address }}/32
    leftrsasigkey=%cert
    # Clients
    right=%any
    rightaddresspool=10.0.10.1-10.0.10.254
    # optional rightid with restrictions
    # rightid="C=CA, L=Toronto, O=Libreswan Project, OU=*, CN=*, E=*"
    rightca=%same
    rightrsasigkey=%cert
    # connection configuration
    # DNS servers for clients to use
    {% for item in upstream_dns_servers %}
    modecfgdns{{ loop.index+1 }} = {{ item }}
    {% endfor %}
    narrowing=yes
    dpddelay=30
    dpdtimeout=120
    dpdaction=clear
    auto=add
    ikev2=insist
    rekey=no
    sha2-truncbug=no
    fragmentation=yes
    encapsulation=yes
    ike=aes256-sha2_512;modp2048,aes128-sha2_512;modp2048,aes256-sha1;modp1024,aes128-sha1;modp1024
	esp=aes_gcm256,aes_gcm128,aes256-sha2_512,aes128-sha2_512
    phase2=esp
